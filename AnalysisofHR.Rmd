---
title: "Analysis of Hr indicators as predictor of employeers left"
author: "Giusti Elena"
date: ""
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
getwd()

source("CopyOfAnalyticsLibraries/library.R")
source("CopyOfAnalyticsLibraries/heatmapOutput.R")

```

###Human Resources Analytics
##Why are our best and most experienced employees leaving prematurely?
 Fields in the dataset include:

Employee satisfaction level
Last evaluation
Number of projects
Average monthly hours
Time spent at the company
Whether they have had a work accident
Whether they have had a promotion in the last 5 years
Department
Salary
Whether the employee has left

```{r, echo=TRUE,eval=TRUE}

myData <- read.csv(file = "DATA/HR_comma_sep.csv", header = TRUE, sep=",")
# This are the project data with an added column of ID

View(myData, header=FALSE)
colnames(myData)
summary(myData)

```
We can make a few observations about the columns –

satisfaction_level: A numeric indictor, presumably (?) filled out by the employee.
last_evaluation: A numeric indicator, presumably filled in by the employee’s manager.
number_project: A integer - perhaps the number of projects the employee has worked on. Is this something like construction?
average_monthly_hours: The number of hours they work (billed?) in the month. On average?
time_spend_company: An integer value, perhaps years of service.
Work_accident: Looks like a boolean value, probably whether or not they had an accident.
left: Looks like a boolean value, leave or not.
promoted_last_5years: Looks like a boolean value.
sales: department
salary: Looks like a 3-level salary score (low, medium, high)

From basic statistic we see that the overall satisfaction of the company is around 
63% and that 24% of the employees left.


####Questions

What are the main factor influencing employers satisfaction?
Which of those factor influence the employeers leaving?


1. Check for correlation

```{r setup, include=FALSE}
CorTable <- cor(myData[,1:6])


ProjectData <- data.matrix(myData)

MIN_VALUE=0.5
max_data_report = 10

colnames("ProjectData")

factor_attributes_used= c(1:6)

# Please ENTER the selection criterions for the factors to use. 
# Choices: "eigenvalue", "variance", "manual"
factor_selectionciterion = "eingenvalue"

# Please ENTER the desired minumum variance explained 
# (ONLY USED in case "variance" is the factor selection criterion used). 
minimum_variance_explained = 65  # between 1 and 100

# Please ENTER the number of factors to use 
# (ONLY USED in case "manual" is the factor selection criterion used).
manual_numb_factors_used = 4

# Please ENTER the rotation eventually used (e.g. "none", "varimax", "quatimax", "promax", "oblimin", "simplimax", and "cluster" - see help(principal)). Defauls is "varimax"
rotation_used="varimax"

factor_attributes_used = unique(sapply(factor_attributes_used,function(i) min(ncol(ProjectData), max(i,1))))
ProjectDataFactor=ProjectData[,factor_attributes_used]
ProjectDataFactor <- ProjectData <- data.matrix(ProjectDataFactor)
```

## Question 1 :  Describe the overall data 





## Step : Confirm data is metric

```{r}
knitr::kable(round(my_summary(ProjectDataFactor), 2))

```
## Step 2: Scale the  data
```{r, echo=TRUE, tidy=TRUE}
ProjectDatafactor_scaled=apply(ProjectDataFactor,2, function(r) {if (sd(r)!=0) res=(r-mean(r))/sd(r) else res=0*r; res})
```
Notice now the summary statistics of the scaled dataset:

```{r}
knitr::kable(round(my_summary(ProjectDatafactor_scaled), 2))
```

```{r}
thecor = round(cor(ProjectDataFactor),2)
colnames(thecor)<-colnames(ProjectDataFactor)
rownames(thecor)<-colnames(ProjectDataFactor)

knitr::kable(round(thecor,2))

```


Apply the facto analysis, set with eingvalue

```{r}
UnRotated_Results<-principal(ProjectDataFactor, nfactors=ncol(ProjectDataFactor), rotate="none",score=TRUE)
UnRotated_Factors<-round(UnRotated_Results$loadings,2)
UnRotated_Factors<-as.data.frame(unclass(UnRotated_Factors))
colnames(UnRotated_Factors)<-paste("Component",1:ncol(UnRotated_Factors),sep=" ")
```

```{r}
Variance_Explained_Table_results<-PCA(ProjectDataFactor, graph=FALSE)
Variance_Explained_Table<-Variance_Explained_Table_results$eig
Variance_Explained_Table_copy<-Variance_Explained_Table


rownames(Variance_Explained_Table) <- paste("Component", 1:nrow(Variance_Explained_Table))
colnames(Variance_Explained_Table) <- c("Eigenvalue", "Pct of explained variance", "Cumulative pct of explained variance")

knitr::kable(round(Variance_Explained_Table, 2))
```